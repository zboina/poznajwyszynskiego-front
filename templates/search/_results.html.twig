{% if results|length > 0 %}
    <div class="results-summary">
        <span>
            Znaleziono <strong>{{ total|number_format(0, ',', ' ') }}</strong>
            {{ total == 1 ? 'tekst' : (total < 5 ? 'teksty' : 'tekstów') }}{% if query %} dla &bdquo;{{ query }}&rdquo;{% endif %}
        </span>
        {% if not canPaginate and total > 10 %}
            <span style="font-size:.7rem; background:#f0ece6; padding:.2rem .5rem; border-radius:6px; color:#999;">10 najlepszych</span>
        {% elseif canPaginate and pages > 1 %}
            <span style="font-size:.7rem; background:#f0ece6; padding:.2rem .5rem; border-radius:6px; color:#999;">{{ page }}/{{ pages }}</span>
        {% endif %}
    </div>

    <div class="d-flex flex-column gap-2">
    {% for row in results %}
        <div class="result-card"
             role="button"
             data-action="click->search#openDocument"
             data-doc-id="{{ row.id }}">
            <div class="d-flex align-items-start">
                <div class="flex-fill" style="min-width:0;">
                    <h4 class="rc-title">{{ row.title ?: '(bez tytułu)' }}</h4>
                    {% if row.subtitle %}
                        <p class="rc-subtitle">{{ row.subtitle }}</p>
                    {% endif %}
                    <div class="rc-meta">
                        {% if row.event_date %}
                            <span>
                                <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><rect x="4" y="5" width="16" height="16" rx="2"/><line x1="16" y1="3" x2="16" y2="7"/><line x1="8" y1="3" x2="8" y2="7"/><line x1="4" y1="11" x2="20" y2="11"/></svg>
                                {{ row.event_date|date('d.m.Y') }}
                            </span>
                        {% endif %}
                        {% if row.location %}
                            <span>
                                <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M18.364 4.636a9 9 0 0 1 .203 12.519l-.203 .21l-4.243 4.242a3 3 0 0 1 -4.097 .135l-.144 -.135l-4.244 -4.243a9 9 0 0 1 12.728 -12.728z"/><circle cx="12" cy="11" r="3"/></svg>
                                {{ row.location }}
                            </span>
                        {% endif %}
                        {% if row.document_type %}
                            <span>
                                <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M14 3v4a1 1 0 0 0 1 1h4"/><path d="M17 21h-10a2 2 0 0 1 -2 -2v-14a2 2 0 0 1 2 -2h7l5 5v11a2 2 0 0 1 -2 2z"/></svg>
                                {{ row.document_type }}
                            </span>
                        {% endif %}
                        {% if row.volume %}
                            <span>
                                <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M3 19a9 9 0 0 1 9 0a9 9 0 0 1 9 0"/><path d="M3 6a9 9 0 0 1 9 0a9 9 0 0 1 9 0"/><line x1="3" y1="6" x2="3" y2="19"/><line x1="12" y1="6" x2="12" y2="19"/><line x1="21" y1="6" x2="21" y2="19"/></svg>
                                Tom {{ row.volume.number }}
                            </span>
                        {% endif %}
                        {% if row.words_count %}
                            <span class="d-none d-sm-inline-flex align-items-center gap-1">{{ row.words_count|number_format(0, ',', ' ') }} słów</span>
                        {% endif %}
                    </div>
                    {% if row.snippet %}
                        <p class="rc-snippet">{{ row.snippet|raw }}</p>
                    {% endif %}
                </div>
                <div class="rc-arrow ms-3 d-none d-md-flex align-items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><polyline points="9 6 15 12 9 18"/></svg>
                </div>
            </div>
        </div>
    {% endfor %}
    </div>

    {# ===== PAGINATION ===== #}
    {% if canPaginate and pages > 1 %}
        <nav class="mt-4 d-flex justify-content-center">
            <ul class="pagination">
                <li class="page-item{{ page <= 1 ? ' disabled' : '' }}">
                    <a class="page-link" href="#" data-action="click->search#goToPage" data-page="{{ page - 1 }}">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><polyline points="15 6 9 12 15 18"/></svg>
                    </a>
                </li>
                {% set start = max(1, page - 2) %}
                {% set end = min(pages, start + 4) %}
                {% set start = max(1, end - 4) %}
                {% if start > 1 %}
                    <li class="page-item">
                        <a class="page-link" href="#" data-action="click->search#goToPage" data-page="1">1</a>
                    </li>
                    {% if start > 2 %}
                        <li class="page-item disabled"><span class="page-link">&hellip;</span></li>
                    {% endif %}
                {% endif %}
                {% for p in start..end %}
                    <li class="page-item{{ p == page ? ' active' : '' }}">
                        <a class="page-link" href="#" data-action="click->search#goToPage" data-page="{{ p }}">{{ p }}</a>
                    </li>
                {% endfor %}
                {% if end < pages %}
                    {% if end < pages - 1 %}
                        <li class="page-item disabled"><span class="page-link">&hellip;</span></li>
                    {% endif %}
                    <li class="page-item">
                        <a class="page-link" href="#" data-action="click->search#goToPage" data-page="{{ pages }}">{{ pages }}</a>
                    </li>
                {% endif %}
                <li class="page-item{{ page >= pages ? ' disabled' : '' }}">
                    <a class="page-link" href="#" data-action="click->search#goToPage" data-page="{{ page + 1 }}">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><polyline points="9 6 15 12 9 18"/></svg>
                    </a>
                </li>
            </ul>
        </nav>
    {% endif %}

{% elseif total is defined %}
    <div class="text-center py-5">
        <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" stroke-width="1" stroke="#ccc" fill="none"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="12" cy="12" r="9"/><line x1="9" y1="10" x2="9.01" y2="10"/><line x1="15" y1="10" x2="15.01" y2="10"/><path d="M9.5 15.25a3.5 3.5 0 0 1 5 0"/></svg>
        <p class="mt-3 mb-1" style="font-size:1.1rem; font-weight:600; color:#888;">Brak wyników</p>
        <p style="font-size:.85rem; color:#bbb;">Spróbuj zmienić kryteria wyszukiwania lub wyczyść filtry</p>
    </div>
{% endif %}
